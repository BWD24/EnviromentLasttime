<!DOCTYPE html>
<html lang="en">

 <head>
        <meta charset="utf-8">
        <title>Trash Map | Greentify</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Pacifico&display=swap" rel="stylesheet">

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Libraries Stylesheet -->
        <link href="lib/animate/animate.min.css" rel="stylesheet">
        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Leaflet JS -->


        <!-- Customized Bootstrap Stylesheet -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        

        <!-- Template Stylesheet -->
        <link href="css/style.css" rel="stylesheet">
        <link rel="stylesheet" href="css/mapPage.css">

           <link rel="icon" type="image/x-icon" href="./img/logo.png">

        <!--  -->




        

</head>

<body>
        <!-- Topbar start -->
<div class="container-fluid fixed-top">
                <nav>
            <div class="container">
                <nav class="navbar navbar-light navbar-expand-lg py-3">
                    <a href="index.html" class="navbar-brand">
        <img src="./img/logo.png" alt="" width="50px" height="50px" >
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                        <span class="fa fa-bars firstColor"></span>
                    </button>
                    <div class="collapse navbar-collapse bg-white" id="navbarCollapse">
                        <div class="navbar-nav ms-lg-auto mx-xl-auto">
                            <a href="index.html" class="nav-item nav-link ">Trang ch·ªß</a>
                            <a href="trashpointmaps.html" class="nav-item nav-link active">B·∫£n ƒë·ªì r√°c th·∫£i</a>
                            <a href="songxanh.html" class="nav-item nav-link">S·ªëng Xanh</a>
                            <a href="menu.html" class="nav-item nav-link">Th·ª±c ƒë∆°n</a>
                            </div>
                   
                        </div>
                        <a href="" class="btn btn-primary py-2 px-4 d-none d-xl-inline-block loginbtn">ƒêƒÉng Nh·∫≠p</a>
             </div>
                </nav>
</div>
        <!-- Topbar End -->


<div class="col-12 trashDisc" style="margin-top: 70px;">
C√πng t·∫°o ra v√πng thu, gom r√°c ph√¢n lo·∫°i v·ªõi ch√∫ng t√¥i, k·∫øt n·ªëi c·ªông ƒë·ªìng ƒë·ªãa ph∆∞∆°ng<br> 
Kh√¥ng x·∫£ r√°c b·ª´a b√£i
</div>


<!-- Map Wrapper Start -->
<div class="map__wrapper w-100 row"  style="margin-top: 120px;  height: 100vh;" >
    <div class="map__wrapper--action col-12  col-lg-4">
<div id="panel" class="w-100" style="">
      <h2> H√†nh ƒë·ªông</h2>
      <button id="locateBtn" onclick="locateUser()">üìç V·ªã tr√≠ c·ªßa t√¥i</button>
      <button id="addFlagBtn" onclick="">üö© G·∫Øn c·ªù ƒëi·ªÉm r√°c th·∫£i</button>
      <button id="addCollectionBtn">‚ûï Th√™m ƒëi·ªÉm thu gom</button>
<div id="controlPanel">
  <select id="trashLevel">
    <option value="normal">üü¢ B√¨nh th∆∞·ªùng</option>
    <option value="serious">üü† Nghi√™m tr·ªçng</option>
    <option value="danger">üî¥ C·∫£nh b√°o √¥ nhi·ªÖm</option>
  </select>

</div>
</div>

<div id="panel" class="w-100" style="">
      <h2>T√¨m ki·∫øm</h2>
    
</div>

  


</div>
            <div class="map-wrapper--map col-12 col-lg-8" >
                <div id="map" class="w-100" style="height: 100%"  ></div>
            </div>
         </div>
      <!-- Map Wrapper End -->
      


    

     


        <!-- Footer Start -->
       <div class="container-fluid footer pt-5 wow fadeIn my-md-5" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row py-5">
                <div class="col-lg-7">
                    <h1 class="text-light mb-0">ƒêƒÉng k√Ω nh·∫≠n b·∫£n tin c·ªßa ch√∫ng t√¥i</h1>
                    <p class="text-secondary">Nh·∫≠n th√¥ng tin m·ªõi nh·∫•t v·ªÅ b·∫£o v·ªá m√¥i tr∆∞·ªùng v√† c√°c m·∫πo hay</p>
                </div>
                <div class="col-lg-5">
                    <div class="position-relative mx-auto">
                        <input class="form-control border-0 w-100 py-3 ps-4 pe-5" type="text" placeholder="Nh·∫≠p email c·ªßa b·∫°n">
                        <button type="button" class="btn  py-2 position-absolute top-0 end-0 mt-2 me-2;" style="background-color: #157347; color: white;">ƒêƒÉng K√Ω</button>
                    </div>
                </div>
                <div class="col-12">
                    <div class="border-top" style="border-color: #157347;"></div>
                </div>
            </div>
            <div class="row g-4 footer-inner">
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item mt-5">
                        <h4 class="text-light mb-4"><span style="color: #157347;">Greentify  Project</span></h4>
                        <p class="mb-4 text-secondary">Ch√∫ng t√¥i cam k·∫øt b·∫£o v·ªá m√¥i tr∆∞·ªùng v√† th√∫c ƒë·∫©y s·ª± ph√°t tri·ªÉn b·ªÅn v·ªØng cho c·ªông ƒë·ªìng v√† h√†nh tinh.</p>
                        <a href="" class="btn" style="background-color: #157347; color: white;">H·ªó tr·ª£ ch√∫ng t√¥i</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item mt-5">
                        <h4 class="text-light mb-4">M√¥i Tr∆∞·ªùng Xanh</h4>
                        <div class="d-flex flex-column">
                            <h6 class="text-secondary mb-0">ƒê·ªãa ch·ªâ c·ªßa ch√∫ng t√¥i</h6>
                            <div class="d-flex align-items-center border-bottom py-4">
                                <span class="flex-shrink-0 btn-square" style="background-color: #157347; color: white; "><i class="fa fa-map-marker-alt text-dark me-3 p-4;"></i></span>
                                <a href="" class="text-body">Tr·∫ßn ƒê·∫°i Nghƒ©a, Ng≈© H√†nh S∆°n, ƒê√† N·∫µng</a>
                            </div>
                            <h6 class="text-secondary mt-4 mb-0">Li√™n h·ªá v·ªõi ch√∫ng t√¥i</h6>
                            <div class="d-flex align-items-center py-4">
                                <span class="flex-shrink-0 btn-square" style="background-color: #157347; color: white; "><i class="fa fa-phone-alt text-dark me-3 p-4;"></i></span>
                                <a href="" class="text-body">+3888730432</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item mt-5">
                        <h4 class="text-light mb-4">C√°c Li√™n K·∫øt Kh√°m Ph√°</h4>
                        <div class="d-flex flex-column align-items-start">
                            <a class="text-body mb-2" href=""><i class="fa fa-check me-2" style="color: #157347; "></i>Trang ch·ªß</a>
                            <a class="text-body mb-2" href=""><i class="fa fa-check me-2" style="color: #157347; "></i>Gi·ªõi thi·ªáu</a>
                            <a class="text-body mb-2" href=""><i class="fa fa-check me-2" style="color: #157347; "></i>C√°c d·ª± √°n c·ªßa ch√∫ng t√¥i</a>
                            <a class="text-body mb-2" href=""><i class="fa fa-check me-2" style="color: #157347; "></i>Li√™n h·ªá</a>
                            <a class="text-body mb-2" href=""><i class="fa fa-check me-2" style="color: #157347; "></i>Blog v·ªÅ m√¥i tr∆∞·ªùng</a>
                            <a class="text-body mb-2" href=""><i class="fa fa-check me-2" style="color: #157347; "></i>Ho·∫°t ƒë·ªông c·ªông ƒë·ªìng</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item mt-5">
                        <h4 class="text-light mb-4">B√†i Vi·∫øt M·ªõi Nh·∫•t</h4>
                        <div class="d-flex border-bottom py-4" style="border-color: #157347; ">
                            <img src="img/blog-mini-1.jpg" class="img-fluid flex-shrink-0" alt="">
                            <div class="ps-3">
                                <p class="mb-0 text-muted">01 Jan 2045</p>
                                <a href="" class="text-body">Nh·ªØng gi·∫£i ph√°p b·∫£o v·ªá m√¥i tr∆∞·ªùng ƒë∆°n gi·∫£n m√† hi·ªáu qu·∫£</a>
                            </div>
                        </div>
                        <div class="d-flex py-4">
                            <img src="img/blog-mini-2.jpg" class="img-fluid flex-shrink-0" alt="">
                            <div class="ps-3">
                                <p class="mb-0 text-muted">01 Jan 2045</p>
                                <a href="" class="text-body">T·∫°i sao ch√∫ng ta c·∫ßn gi·∫£m thi·ªÉu ch·∫•t th·∫£i nh·ª±a ngay b√¢y gi·ªù?</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container py-4">
            <div class="border-top pb-4" style="border-color: #157347; "></div>
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    &copy; <a class="border-bottom" href="#">Grentify </a>, T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.
                </div>
            
            </div>
        </div>
    </div>
        <!-- Footer End -->


        <!-- Back to Top -->
        <a href="#" class="btn btn-primary border-3 border-light back-to-top"><i class="fa fa-arrow-up"></i></a>   

        
        <!-- JavaScript Libraries -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="lib/wow/wow.min.js"></script>
        <script src="lib/easing/easing.min.js"></script>
        <script src="lib/waypoints/waypoints.min.js"></script>
        <script src="lib/owlcarousel/owl.carousel.min.js"></script>
       

        <!-- Template Javascript -->
   
        <script src="./lib/leaflet/leaflet.js"></script>
        <script src="js/main.js"></script>
        <script src="js/map.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Firebase SDK (compat version for vanilla JS) -->
  <script src="https://www.gstatic.com/firebasejs/11.7.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.7.3/firebase-database-compat.js"></script>

  <script>
    // Kh·ªüi t·∫°o Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCnjDsl54xYhEAYJp5z_PIVjXQ4JQbADEM",
      authDomain: "enviroment-e0547.firebaseapp.com",
      databaseURL: "https://enviroment-e0547-default-rtdb.firebaseio.com",
      projectId: "enviroment-e0547",
      storageBucket: "enviroment-e0547.appspot.com",
      messagingSenderId: "958910478886",
      appId: "1:958910478886:web:5ebb2a49583cab4439c4e7"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Kh·ªüi t·∫°o b·∫£n ƒë·ªì
    let map = L.map('map').setView([10.762622, 106.660172], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // G·∫Øn c·ªù t·ª´ click
    let selectedLatLng = null;
    map.on('click', function (e) {
      selectedLatLng = [e.latlng.lat, e.latlng.lng];
      L.popup()
        .setLatLng(e.latlng)
        .setContent("üëâ ƒê√£ ch·ªçn v·ªã tr√≠ n√†y ƒë·ªÉ g·∫Øn c·ªù")
        .openOn(map);
    });

    // H√†m l∆∞u c·ªù r√°c


    // Hi·ªÉn th·ªã marker + v√≤ng c·∫£nh b√°o
      const flagIcon = L.icon({
    iconUrl: './img/flag.png',  // URL c·ªßa ·∫£nh c·ªù (thay b·∫±ng ·∫£nh c·ªßa b·∫°n)
    iconSize: [32, 32],     // K√≠ch th∆∞·ªõc icon
    iconAnchor: [16, 32],   // Neo t·∫°i d∆∞·ªõi c√πng
    popupAnchor: [0, -32]   // V·ªã tr√≠ popup (hi·ªÉn th·ªã tr√™n ·∫£nh)
  });

  function reportTrash(lat, lng, level) {
  const refPath = db.ref("trashFlags").push();
  refPath.set({
    lat:lat,
    lng:lng,
    level:level,
    timestamp: Date.now()
  });
}

function displayTrashFlag(lat, lng, level = "normal") {
  let iconUrl;
  switch (level) {
    case "normal": iconUrl = "img/greenflag.png"; break;
    case "serious": iconUrl = "img/yellowFlag.png"; break;
    case "danger": iconUrl = "img/redFlag.png"; break;
   
  }
  const icon = L.icon({
    iconUrl,
    iconSize: [32, 32]
  });

  L.marker([lat, lng], { icon }).addTo(map).bindPopup(`üö© M·ª©c ƒë·ªô: ${level}`);
  L.circle([lat, lng], {
    radius: 30,
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.2
  }).addTo(map);
}




    // ƒê·ªçc v√† hi·ªÉn th·ªã c·ªù t·ª´ Firebase
function loadAllTrashFlags() {
  db.ref("trashFlags").on("value", (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    Object.values(data).forEach(({ lat, lng, level }) => {
      displayTrashFlag(lat, lng, level);
    });
  });
}


const flagAddBtn = document.querySelector('#addFlagBtn'); 
console.log(flagAddBtn);


    // G·∫Øn s·ª± ki·ªán cho n√∫t
   document.getElementById("addFlagBtn").onclick = () => {
  if (selectedLatLng) {
    const [lat, lng] = selectedLatLng;
    const level = document.getElementById("trashLevel").value;
  
    reportTrash(lat, lng, level);
    displayTrashFlag(lat, lng, level);
      loadAllTrashFlags(); 
    
  } else {
    alert("üìç Click v√†o b·∫£n ƒë·ªì ƒë·ªÉ ch·ªçn v·ªã tr√≠ tr∆∞·ªõc!");
  }
};
    // T·∫£i d·ªØ li·ªáu khi b·∫Øt ƒë·∫ßu
    loadAllTrashFlags();

    function locateUser() {
  if (!navigator.geolocation) {
    alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (position) => {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      const userLatLng = [lat, lng];

      // Di chuy·ªÉn m∆∞·ª£t t·ªõi v·ªã tr√≠ ng∆∞·ªùi d√πng
      map.flyTo(userLatLng, 16, {
        animate: true,
        duration: 1.5 // gi√¢y
      });

      // Hi·ªÉn th·ªã marker v·ªã tr√≠ ng∆∞·ªùi d√πng
      const marker = L.marker(userLatLng).addTo(map);
      marker.bindPopup("üìç V·ªã tr√≠ c·ªßa b·∫°n").openPopup();
    },
    (error) => {
      alert("Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠."  + error) ;
    }
  );
}



// Icon ƒëi·ªÉm thu gom r√°c (xanh l√°)
// const collectionIcon = L.icon({
//   iconUrl: 'path/to/flag-green.png', // ‚Üê d√πng icon b·∫°n v·ª´a t·∫°o
//   iconSize: [32, 32],
//   iconAnchor: [16, 32],
//   popupAnchor: [0, -32]
// });

// H√†m l∆∞u ƒëi·ªÉm thu gom v√†o Firebase
function reportCollectionPoint(lat, lng) {
  const refPoint = db.ref("collectionPoints").push(); 
  refPoint.set({
    lat,
    lng,
    timestamp: Date.now()
  });
}

// H√†m hi·ªÉn th·ªã ƒëi·ªÉm thu gom



document.getElementById("addCollectionBtn").onclick = () => {
  if (selectedLatLng) {
    const [lat, lng] = selectedLatLng;
    reportCollectionPoint(lat, lng);       // G·ª≠i l√™n Firebase
    displayCollectionPoint(lat, lng);      // Hi·ªÉn th·ªã tr√™n b·∫£n ƒë·ªì
    loadCollectionPoints(); 

  } else {
    alert("‚ùóB·∫°n ch∆∞a ch·ªçn v·ªã tr√≠ tr√™n b·∫£n ƒë·ªì!");
  }
};



 const collectionIcon = L.icon({
  iconUrl: 'https://cdn-icons-png.flaticon.com/512/3096/3096687.png',
  iconSize: [32, 32],
  iconAnchor: [16, 32],
  popupAnchor: [0, -32]
});

function displayCollectionPoint(lat, lng) {
  const icon = L.icon({
    iconUrl: "img/trash.png", // B·∫°n c√≥ th·ªÉ ƒë·ªïi icon ƒëi·ªÉm thu gom
    iconSize: [30, 30],
    iconAnchor: [15, 30]
  });

  L.marker([lat, lng], { icon })
    .addTo(map)
    .bindPopup("üì¶ ƒêi·ªÉm thu gom");
}

// B·∫Øt s·ª± ki·ªán click n√∫t th√™m ƒëi·ªÉm thu gom
map.on("click", function (e) {
  selectedLatLng = [e.latlng.lat, e.latlng.lng];
  alert("üìç ƒê√£ ch·ªçn v·ªã tr√≠ t·∫°i: " + selectedLatLng.join(", "));
});



function loadCollectionPoints() {
  firebase.database().ref("collectionPoints").once("value", (snapshot) => {
    const data = snapshot.val();
    if (data) {
      Object.values(data).forEach(({ lat, lng }) => {
        displayCollectionPoint(lat, lng);
      });
    }
  });
}

loadCollectionPoints(); 

  </script>
    </body>

</html>